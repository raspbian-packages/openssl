From: Matt Caswell <matt@openssl.org>
Date: Mon, 23 Aug 2021 20:41:38 +0100
Subject: fixup! Fix i2v_GENERAL_NAME to not assume NUL terminated strings

---
 crypto/x509v3/v3_utl.c | 9 ++++++---
 1 file changed, 6 insertions(+), 3 deletions(-)

Index: openssl-1.1.0l/crypto/x509v3/v3_utl.c
===================================================================
--- openssl-1.1.0l.orig/crypto/x509v3/v3_utl.c	2021-09-26 00:24:03.112051111 +0200
+++ openssl-1.1.0l/crypto/x509v3/v3_utl.c	2021-09-26 00:24:03.112051111 +0200
@@ -43,9 +43,12 @@
 
     if (name != NULL && (tname = OPENSSL_strdup(name)) == NULL)
         goto err;
-    if (value != NULL) {
-        /* We don't allow embeded NUL characters */
-        if (memchr(value, 0, vallen) != NULL)
+    if (value != NULL && vallen > 0) {
+        /*
+         * We tolerate a single trailing NUL character, but otherwise no
+         * embedded NULs
+         */
+        if (memchr(value, 0, vallen - 1) != NULL)
             goto err;
         tvalue = OPENSSL_strndup(value, vallen);
         if (tvalue == NULL)
